{"version":3,"sources":["src/solution/domHelpers.js","src/solution/pages.js","src/helpers/compress.js","node_modules/exif-js/exif.js","src/helpers/fixOrientation.js","src/helpers/crop.js","src/helpers/_transform.js","node_modules/alloyfinger/alloy_finger.js","src/helpers/cropUI.js","src/helpers/index.js","src/solution/index.js"],"names":["toArray","Function","prototype","bind","call","slice","qsa","selector","element","document","body","querySelectorAll","addClass","el","className","classList","add","removeClass","remove","on","type","listener","capture","addEventListener","removeEventListener","css","obj","key","style","CACHED","resolveEvents","container","resolved","events","Object","entries","map","split","querySelector","loadPage","page","param","_unlistens","forEach","f","_onCached","render","cached","compress","file","quality","Promise","resolve","reject","imgEl","Image","src","window","URL","createObjectURL","onerror","onload","originWidth","width","originHeight","height","maxWidth","innerWidth","devicePixelRatio","maxHeight","innerHeight","targetWidth","targetHeight","Math","round","canvas","createElement","ctx","getContext","clearRect","drawImage","toBlob","fixOrientation","img","getData","orientation","EXIF","getTag","rotate","PI","getOverlap","ax1","ay1","ax2","ay2","bx1","by1","bx2","by2","left","max","top","min","calculateRect","rect","cr","getBoundingClientRect","c_left","c_top","cover_rect","img_rect","intersect_rect","apply","concat","scaleX","scaleY","naturalWidth","naturalHeight","drawCrop","cropRect","output","getCrop","Transform","Matrix3D","n11","n12","n13","n14","n21","n22","n23","n24","n31","n32","n33","n34","n41","n42","n43","n44","elements","Float32Array","te","undefined","observe","target","props","callback","i","len","length","watch","prop","defineProperty","get","set","value","DEG_TO_RAD","identity","multiplyMatrices","a","be","ae","a11","a12","a13","a14","a21","a22","a23","a24","a31","a32","a33","a34","a41","a42","a43","a44","b11","b12","b13","b14","b21","b22","b23","b24","b31","b32","b33","b34","b41","b42","b43","b44","_rounded","pow","appendTransform","x","y","z","scaleZ","rotateX","rotateY","rotateZ","skewX","skewY","originX","originY","originZ","rx","cosx","cos","sinx","sin","ry","cosy","siny","rz","cosz","sinz","mtx","matrix3D","translateX","translateY","translateZ","transform","msTransform","OTransform","MozTransform","webkitTransform","perspective","Array","join","getLen","v","sqrt","getRotateAngle","v1","v2","angle","getAngle","mr","r","dot","acos","cross","HandlerAdmin","handlers","wrapFunc","handler","handlerAdmin","push","del","splice","dispatch","arguments","AlloyFinger","option","start","move","end","cancel","preV","pinchStartLen","zoom","isDoubleTap","noop","touchStart","multipointStart","multipointEnd","pinch","swipe","tap","doubleTap","longTap","singleTap","pressMove","twoFingerPressMove","touchMove","touchEnd","touchCancel","_cancelAllHandler","cancelAll","delta","last","now","tapTimeout","singleTapTimeout","longTapTimeout","swipeTimeout","x1","x2","y1","y2","preTapPosition","evt","touches","Date","pageX","pageY","abs","clearTimeout","_cancelLongTap","_cancelSingleTap","_preventTap","setTimeout","currentX","currentY","sCurrentX","sCurrentY","sx2","deltaX","deltaY","sy2","movedX","movedY","preventDefault","changedTouches","self","direction","_swipeDirection","off","destroy","module","exports","transformImage","cropBox","scaling_x","initScale","originScale","first","Finger","centerX","centerY","offX","offY","preOriginX","preOriginY","boxOffY","documentElement","clientHeight","tempo","dw","dh","right","bottom","boxOffX","clientWidth","renderCover","cover","rectangle","w","h","cw","ch","save","fillStyle","globalAlpha","fillRect","restore","globalCompositeOperation","beginPath","arc","fill","strokeStyle","stroke","createBox","color","textAlign","fontSize","textDecoration","visibility","styleImage","position","zIndex","marginLeft","marginTop","styleCover","onFileChange","e","currentFiles","files","then","crop","imageSrc","home","pageName","getElementById","click","result","appendChild","prevBox","removeChild","location","reload","resultCanvas"],"mappings":"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","file":"solution.1ca51544.map","sourceRoot":"..","sourcesContent":["let toArray = Function.prototype.bind.call(Function.prototype.call, [].slice);\r\n\r\n/**\r\n * \r\n * @param {string} selector \r\n * @param {HTMLElement} element \r\n * @returns {HTMLElement[]}\r\n */\r\nexport function qsa (selector, element = document.body) {\r\n    return toArray(element.querySelectorAll(selector));\r\n}\r\n\r\n/**\r\n * \r\n * @param {HTMLElement} el \r\n * @param {string} className \r\n */\r\nexport function addClass (el, className) {\r\n    el.classList.add(className);\r\n}\r\n\r\n/**\r\n * \r\n * @param {HTMLElement} el \r\n * @param {string} className \r\n */\r\nexport function removeClass (el, className) {\r\n    el.classList.remove(className);\r\n}\r\n\r\n/**\r\n * \r\n * @param {HTMLElement} el \r\n * @param {string} type \r\n * @param {Function} listener \r\n * @param {boolean} [capture=false]\r\n */\r\nexport function on (el, type, listener, capture = false) {\r\n    el.addEventListener(type, listener);\r\n    return () => {\r\n        el.removeEventListener(type, listener, capture);\r\n    };\r\n}\r\n\r\n/**\r\n * 修改样式\r\n * @param {HTMLElement} el\r\n * @param {object<string>} obj\r\n */\r\nexport function css (el, obj) {\r\n    for (let key in obj) {\r\n        el.style[key] = obj[key];\r\n    }\r\n}\r\n","\r\nimport { qsa, addClass, removeClass, on } from './domHelpers';\r\n\r\nconst CACHED = 'cached';\r\n\r\nfunction resolveEvents ({ container, events }) {\r\n    const resolved = events(container);\r\n\r\n    return resolved\r\n        ? Object.entries(resolved).map(([key, listener]) => {\r\n            const [selector, type] = key.split(':');\r\n            return on(container.querySelector(selector), type, listener);\r\n        })\r\n        : [];\r\n}\r\n\r\n/**\r\n * @typedef {Object} Page\r\n * @prop {HTMLElement} container\r\n * @prop {(container: HTMLElement) => Object} events\r\n * @prop {(container: HTMLElement, param) => void} render\r\n * @prop {(container: HTMLElement) => void} cached\r\n *\r\n * @param {Page} page \r\n */\r\nexport function loadPage (page, param) {\r\n    const notCached = qsa('.page:not(.cached)');\r\n    notCached.map(el => {\r\n        addClass(el, CACHED); // cached\r\n        if (el._unlistens) { // unlisten\r\n            el._unlistens.forEach(f => f());\r\n            el._unlistens = null;\r\n        }\r\n        el._onCached && el._onCached(el); // cache hook\r\n    });\r\n\r\n    removeClass(page.container, CACHED);\r\n    page.container._unlistens = resolveEvents(page);\r\n    page.render(page.container, param);\r\n    page.container._onCached = page.cached;\r\n}\r\n","/**\r\n * 图片压缩\r\n * @param {File | string} file 输入图片\r\n * @param {number} quality\r\n * @returns {Promise<File>}\r\n */\r\nexport function compress(file, quality = 0.92) {\r\n    return new Promise((resolve, reject) => {\r\n        const imgEl = new Image();\r\n        imgEl.src = typeof file === 'string' ? file : window.URL.createObjectURL(file);\r\n        imgEl.onerror = () => reject(file);\r\n        imgEl.onload = () => {\r\n            const originWidth = imgEl.width;\r\n            const originHeight = imgEl.height;\r\n            const maxWidth = window.innerWidth * window.devicePixelRatio;\r\n            const maxHeight = window.innerHeight * window.devicePixelRatio;\r\n            let targetWidth = originWidth;\r\n            let targetHeight = originHeight;\r\n            if (originWidth > maxWidth || originHeight > maxHeight) {\r\n                if (originWidth / originHeight > maxWidth / maxHeight) {\r\n                    targetWidth = maxWidth;\r\n                    targetHeight = Math.round(maxWidth * (originHeight / originWidth));\r\n                }\r\n                else {\r\n                    targetHeight = maxHeight;\r\n                    targetWidth = Math.round(maxHeight * (originWidth / originHeight));\r\n                }\r\n            }\r\n            const canvas = document.createElement('canvas');\r\n            const ctx = canvas.getContext('2d');\r\n            canvas.width = targetWidth;\r\n            canvas.height = targetHeight;\r\n            ctx.clearRect(0, 0, targetWidth, targetHeight); // 清除画布\r\n            ctx.drawImage(imgEl, 0, 0, targetWidth, targetHeight); // 图片压缩\r\n            canvas.toBlob(file => resolve(file), 'image/jpeg', quality);\r\n        };\r\n    });\r\n}","(function() {\n\n    var debug = false;\n\n    var root = this;\n\n    var EXIF = function(obj) {\n        if (obj instanceof EXIF) return obj;\n        if (!(this instanceof EXIF)) return new EXIF(obj);\n        this.EXIFwrapped = obj;\n    };\n\n    if (typeof exports !== 'undefined') {\n        if (typeof module !== 'undefined' && module.exports) {\n            exports = module.exports = EXIF;\n        }\n        exports.EXIF = EXIF;\n    } else {\n        root.EXIF = EXIF;\n    }\n\n    var ExifTags = EXIF.Tags = {\n\n        // version tags\n        0x9000 : \"ExifVersion\",             // EXIF version\n        0xA000 : \"FlashpixVersion\",         // Flashpix format version\n\n        // colorspace tags\n        0xA001 : \"ColorSpace\",              // Color space information tag\n\n        // image configuration\n        0xA002 : \"PixelXDimension\",         // Valid width of meaningful image\n        0xA003 : \"PixelYDimension\",         // Valid height of meaningful image\n        0x9101 : \"ComponentsConfiguration\", // Information about channels\n        0x9102 : \"CompressedBitsPerPixel\",  // Compressed bits per pixel\n\n        // user information\n        0x927C : \"MakerNote\",               // Any desired information written by the manufacturer\n        0x9286 : \"UserComment\",             // Comments by user\n\n        // related file\n        0xA004 : \"RelatedSoundFile\",        // Name of related sound file\n\n        // date and time\n        0x9003 : \"DateTimeOriginal\",        // Date and time when the original image was generated\n        0x9004 : \"DateTimeDigitized\",       // Date and time when the image was stored digitally\n        0x9290 : \"SubsecTime\",              // Fractions of seconds for DateTime\n        0x9291 : \"SubsecTimeOriginal\",      // Fractions of seconds for DateTimeOriginal\n        0x9292 : \"SubsecTimeDigitized\",     // Fractions of seconds for DateTimeDigitized\n\n        // picture-taking conditions\n        0x829A : \"ExposureTime\",            // Exposure time (in seconds)\n        0x829D : \"FNumber\",                 // F number\n        0x8822 : \"ExposureProgram\",         // Exposure program\n        0x8824 : \"SpectralSensitivity\",     // Spectral sensitivity\n        0x8827 : \"ISOSpeedRatings\",         // ISO speed rating\n        0x8828 : \"OECF\",                    // Optoelectric conversion factor\n        0x9201 : \"ShutterSpeedValue\",       // Shutter speed\n        0x9202 : \"ApertureValue\",           // Lens aperture\n        0x9203 : \"BrightnessValue\",         // Value of brightness\n        0x9204 : \"ExposureBias\",            // Exposure bias\n        0x9205 : \"MaxApertureValue\",        // Smallest F number of lens\n        0x9206 : \"SubjectDistance\",         // Distance to subject in meters\n        0x9207 : \"MeteringMode\",            // Metering mode\n        0x9208 : \"LightSource\",             // Kind of light source\n        0x9209 : \"Flash\",                   // Flash status\n        0x9214 : \"SubjectArea\",             // Location and area of main subject\n        0x920A : \"FocalLength\",             // Focal length of the lens in mm\n        0xA20B : \"FlashEnergy\",             // Strobe energy in BCPS\n        0xA20C : \"SpatialFrequencyResponse\",    //\n        0xA20E : \"FocalPlaneXResolution\",   // Number of pixels in width direction per FocalPlaneResolutionUnit\n        0xA20F : \"FocalPlaneYResolution\",   // Number of pixels in height direction per FocalPlaneResolutionUnit\n        0xA210 : \"FocalPlaneResolutionUnit\",    // Unit for measuring FocalPlaneXResolution and FocalPlaneYResolution\n        0xA214 : \"SubjectLocation\",         // Location of subject in image\n        0xA215 : \"ExposureIndex\",           // Exposure index selected on camera\n        0xA217 : \"SensingMethod\",           // Image sensor type\n        0xA300 : \"FileSource\",              // Image source (3 == DSC)\n        0xA301 : \"SceneType\",               // Scene type (1 == directly photographed)\n        0xA302 : \"CFAPattern\",              // Color filter array geometric pattern\n        0xA401 : \"CustomRendered\",          // Special processing\n        0xA402 : \"ExposureMode\",            // Exposure mode\n        0xA403 : \"WhiteBalance\",            // 1 = auto white balance, 2 = manual\n        0xA404 : \"DigitalZoomRation\",       // Digital zoom ratio\n        0xA405 : \"FocalLengthIn35mmFilm\",   // Equivalent foacl length assuming 35mm film camera (in mm)\n        0xA406 : \"SceneCaptureType\",        // Type of scene\n        0xA407 : \"GainControl\",             // Degree of overall image gain adjustment\n        0xA408 : \"Contrast\",                // Direction of contrast processing applied by camera\n        0xA409 : \"Saturation\",              // Direction of saturation processing applied by camera\n        0xA40A : \"Sharpness\",               // Direction of sharpness processing applied by camera\n        0xA40B : \"DeviceSettingDescription\",    //\n        0xA40C : \"SubjectDistanceRange\",    // Distance to subject\n\n        // other tags\n        0xA005 : \"InteroperabilityIFDPointer\",\n        0xA420 : \"ImageUniqueID\"            // Identifier assigned uniquely to each image\n    };\n\n    var TiffTags = EXIF.TiffTags = {\n        0x0100 : \"ImageWidth\",\n        0x0101 : \"ImageHeight\",\n        0x8769 : \"ExifIFDPointer\",\n        0x8825 : \"GPSInfoIFDPointer\",\n        0xA005 : \"InteroperabilityIFDPointer\",\n        0x0102 : \"BitsPerSample\",\n        0x0103 : \"Compression\",\n        0x0106 : \"PhotometricInterpretation\",\n        0x0112 : \"Orientation\",\n        0x0115 : \"SamplesPerPixel\",\n        0x011C : \"PlanarConfiguration\",\n        0x0212 : \"YCbCrSubSampling\",\n        0x0213 : \"YCbCrPositioning\",\n        0x011A : \"XResolution\",\n        0x011B : \"YResolution\",\n        0x0128 : \"ResolutionUnit\",\n        0x0111 : \"StripOffsets\",\n        0x0116 : \"RowsPerStrip\",\n        0x0117 : \"StripByteCounts\",\n        0x0201 : \"JPEGInterchangeFormat\",\n        0x0202 : \"JPEGInterchangeFormatLength\",\n        0x012D : \"TransferFunction\",\n        0x013E : \"WhitePoint\",\n        0x013F : \"PrimaryChromaticities\",\n        0x0211 : \"YCbCrCoefficients\",\n        0x0214 : \"ReferenceBlackWhite\",\n        0x0132 : \"DateTime\",\n        0x010E : \"ImageDescription\",\n        0x010F : \"Make\",\n        0x0110 : \"Model\",\n        0x0131 : \"Software\",\n        0x013B : \"Artist\",\n        0x8298 : \"Copyright\"\n    };\n\n    var GPSTags = EXIF.GPSTags = {\n        0x0000 : \"GPSVersionID\",\n        0x0001 : \"GPSLatitudeRef\",\n        0x0002 : \"GPSLatitude\",\n        0x0003 : \"GPSLongitudeRef\",\n        0x0004 : \"GPSLongitude\",\n        0x0005 : \"GPSAltitudeRef\",\n        0x0006 : \"GPSAltitude\",\n        0x0007 : \"GPSTimeStamp\",\n        0x0008 : \"GPSSatellites\",\n        0x0009 : \"GPSStatus\",\n        0x000A : \"GPSMeasureMode\",\n        0x000B : \"GPSDOP\",\n        0x000C : \"GPSSpeedRef\",\n        0x000D : \"GPSSpeed\",\n        0x000E : \"GPSTrackRef\",\n        0x000F : \"GPSTrack\",\n        0x0010 : \"GPSImgDirectionRef\",\n        0x0011 : \"GPSImgDirection\",\n        0x0012 : \"GPSMapDatum\",\n        0x0013 : \"GPSDestLatitudeRef\",\n        0x0014 : \"GPSDestLatitude\",\n        0x0015 : \"GPSDestLongitudeRef\",\n        0x0016 : \"GPSDestLongitude\",\n        0x0017 : \"GPSDestBearingRef\",\n        0x0018 : \"GPSDestBearing\",\n        0x0019 : \"GPSDestDistanceRef\",\n        0x001A : \"GPSDestDistance\",\n        0x001B : \"GPSProcessingMethod\",\n        0x001C : \"GPSAreaInformation\",\n        0x001D : \"GPSDateStamp\",\n        0x001E : \"GPSDifferential\"\n    };\n\n     // EXIF 2.3 Spec\n    var IFD1Tags = EXIF.IFD1Tags = {\n        0x0100: \"ImageWidth\",\n        0x0101: \"ImageHeight\",\n        0x0102: \"BitsPerSample\",\n        0x0103: \"Compression\",\n        0x0106: \"PhotometricInterpretation\",\n        0x0111: \"StripOffsets\",\n        0x0112: \"Orientation\",\n        0x0115: \"SamplesPerPixel\",\n        0x0116: \"RowsPerStrip\",\n        0x0117: \"StripByteCounts\",\n        0x011A: \"XResolution\",\n        0x011B: \"YResolution\",\n        0x011C: \"PlanarConfiguration\",\n        0x0128: \"ResolutionUnit\",\n        0x0201: \"JpegIFOffset\",    // When image format is JPEG, this value show offset to JPEG data stored.(aka \"ThumbnailOffset\" or \"JPEGInterchangeFormat\")\n        0x0202: \"JpegIFByteCount\", // When image format is JPEG, this value shows data size of JPEG image (aka \"ThumbnailLength\" or \"JPEGInterchangeFormatLength\")\n        0x0211: \"YCbCrCoefficients\",\n        0x0212: \"YCbCrSubSampling\",\n        0x0213: \"YCbCrPositioning\",\n        0x0214: \"ReferenceBlackWhite\"\n    };\n\n    var StringValues = EXIF.StringValues = {\n        ExposureProgram : {\n            0 : \"Not defined\",\n            1 : \"Manual\",\n            2 : \"Normal program\",\n            3 : \"Aperture priority\",\n            4 : \"Shutter priority\",\n            5 : \"Creative program\",\n            6 : \"Action program\",\n            7 : \"Portrait mode\",\n            8 : \"Landscape mode\"\n        },\n        MeteringMode : {\n            0 : \"Unknown\",\n            1 : \"Average\",\n            2 : \"CenterWeightedAverage\",\n            3 : \"Spot\",\n            4 : \"MultiSpot\",\n            5 : \"Pattern\",\n            6 : \"Partial\",\n            255 : \"Other\"\n        },\n        LightSource : {\n            0 : \"Unknown\",\n            1 : \"Daylight\",\n            2 : \"Fluorescent\",\n            3 : \"Tungsten (incandescent light)\",\n            4 : \"Flash\",\n            9 : \"Fine weather\",\n            10 : \"Cloudy weather\",\n            11 : \"Shade\",\n            12 : \"Daylight fluorescent (D 5700 - 7100K)\",\n            13 : \"Day white fluorescent (N 4600 - 5400K)\",\n            14 : \"Cool white fluorescent (W 3900 - 4500K)\",\n            15 : \"White fluorescent (WW 3200 - 3700K)\",\n            17 : \"Standard light A\",\n            18 : \"Standard light B\",\n            19 : \"Standard light C\",\n            20 : \"D55\",\n            21 : \"D65\",\n            22 : \"D75\",\n            23 : \"D50\",\n            24 : \"ISO studio tungsten\",\n            255 : \"Other\"\n        },\n        Flash : {\n            0x0000 : \"Flash did not fire\",\n            0x0001 : \"Flash fired\",\n            0x0005 : \"Strobe return light not detected\",\n            0x0007 : \"Strobe return light detected\",\n            0x0009 : \"Flash fired, compulsory flash mode\",\n            0x000D : \"Flash fired, compulsory flash mode, return light not detected\",\n            0x000F : \"Flash fired, compulsory flash mode, return light detected\",\n            0x0010 : \"Flash did not fire, compulsory flash mode\",\n            0x0018 : \"Flash did not fire, auto mode\",\n            0x0019 : \"Flash fired, auto mode\",\n            0x001D : \"Flash fired, auto mode, return light not detected\",\n            0x001F : \"Flash fired, auto mode, return light detected\",\n            0x0020 : \"No flash function\",\n            0x0041 : \"Flash fired, red-eye reduction mode\",\n            0x0045 : \"Flash fired, red-eye reduction mode, return light not detected\",\n            0x0047 : \"Flash fired, red-eye reduction mode, return light detected\",\n            0x0049 : \"Flash fired, compulsory flash mode, red-eye reduction mode\",\n            0x004D : \"Flash fired, compulsory flash mode, red-eye reduction mode, return light not detected\",\n            0x004F : \"Flash fired, compulsory flash mode, red-eye reduction mode, return light detected\",\n            0x0059 : \"Flash fired, auto mode, red-eye reduction mode\",\n            0x005D : \"Flash fired, auto mode, return light not detected, red-eye reduction mode\",\n            0x005F : \"Flash fired, auto mode, return light detected, red-eye reduction mode\"\n        },\n        SensingMethod : {\n            1 : \"Not defined\",\n            2 : \"One-chip color area sensor\",\n            3 : \"Two-chip color area sensor\",\n            4 : \"Three-chip color area sensor\",\n            5 : \"Color sequential area sensor\",\n            7 : \"Trilinear sensor\",\n            8 : \"Color sequential linear sensor\"\n        },\n        SceneCaptureType : {\n            0 : \"Standard\",\n            1 : \"Landscape\",\n            2 : \"Portrait\",\n            3 : \"Night scene\"\n        },\n        SceneType : {\n            1 : \"Directly photographed\"\n        },\n        CustomRendered : {\n            0 : \"Normal process\",\n            1 : \"Custom process\"\n        },\n        WhiteBalance : {\n            0 : \"Auto white balance\",\n            1 : \"Manual white balance\"\n        },\n        GainControl : {\n            0 : \"None\",\n            1 : \"Low gain up\",\n            2 : \"High gain up\",\n            3 : \"Low gain down\",\n            4 : \"High gain down\"\n        },\n        Contrast : {\n            0 : \"Normal\",\n            1 : \"Soft\",\n            2 : \"Hard\"\n        },\n        Saturation : {\n            0 : \"Normal\",\n            1 : \"Low saturation\",\n            2 : \"High saturation\"\n        },\n        Sharpness : {\n            0 : \"Normal\",\n            1 : \"Soft\",\n            2 : \"Hard\"\n        },\n        SubjectDistanceRange : {\n            0 : \"Unknown\",\n            1 : \"Macro\",\n            2 : \"Close view\",\n            3 : \"Distant view\"\n        },\n        FileSource : {\n            3 : \"DSC\"\n        },\n\n        Components : {\n            0 : \"\",\n            1 : \"Y\",\n            2 : \"Cb\",\n            3 : \"Cr\",\n            4 : \"R\",\n            5 : \"G\",\n            6 : \"B\"\n        }\n    };\n\n    function addEvent(element, event, handler) {\n        if (element.addEventListener) {\n            element.addEventListener(event, handler, false);\n        } else if (element.attachEvent) {\n            element.attachEvent(\"on\" + event, handler);\n        }\n    }\n\n    function imageHasData(img) {\n        return !!(img.exifdata);\n    }\n\n\n    function base64ToArrayBuffer(base64, contentType) {\n        contentType = contentType || base64.match(/^data\\:([^\\;]+)\\;base64,/mi)[1] || ''; // e.g. 'data:image/jpeg;base64,...' => 'image/jpeg'\n        base64 = base64.replace(/^data\\:([^\\;]+)\\;base64,/gmi, '');\n        var binary = atob(base64);\n        var len = binary.length;\n        var buffer = new ArrayBuffer(len);\n        var view = new Uint8Array(buffer);\n        for (var i = 0; i < len; i++) {\n            view[i] = binary.charCodeAt(i);\n        }\n        return buffer;\n    }\n\n    function objectURLToBlob(url, callback) {\n        var http = new XMLHttpRequest();\n        http.open(\"GET\", url, true);\n        http.responseType = \"blob\";\n        http.onload = function(e) {\n            if (this.status == 200 || this.status === 0) {\n                callback(this.response);\n            }\n        };\n        http.send();\n    }\n\n    function getImageData(img, callback) {\n        function handleBinaryFile(binFile) {\n            var data = findEXIFinJPEG(binFile);\n            img.exifdata = data || {};\n            var iptcdata = findIPTCinJPEG(binFile);\n            img.iptcdata = iptcdata || {};\n            if (EXIF.isXmpEnabled) {\n               var xmpdata= findXMPinJPEG(binFile);\n               img.xmpdata = xmpdata || {};               \n            }\n            if (callback) {\n                callback.call(img);\n            }\n        }\n\n        if (img.src) {\n            if (/^data\\:/i.test(img.src)) { // Data URI\n                var arrayBuffer = base64ToArrayBuffer(img.src);\n                handleBinaryFile(arrayBuffer);\n\n            } else if (/^blob\\:/i.test(img.src)) { // Object URL\n                var fileReader = new FileReader();\n                fileReader.onload = function(e) {\n                    handleBinaryFile(e.target.result);\n                };\n                objectURLToBlob(img.src, function (blob) {\n                    fileReader.readAsArrayBuffer(blob);\n                });\n            } else {\n                var http = new XMLHttpRequest();\n                http.onload = function() {\n                    if (this.status == 200 || this.status === 0) {\n                        handleBinaryFile(http.response);\n                    } else {\n                        throw \"Could not load image\";\n                    }\n                    http = null;\n                };\n                http.open(\"GET\", img.src, true);\n                http.responseType = \"arraybuffer\";\n                http.send(null);\n            }\n        } else if (self.FileReader && (img instanceof self.Blob || img instanceof self.File)) {\n            var fileReader = new FileReader();\n            fileReader.onload = function(e) {\n                if (debug) console.log(\"Got file of length \" + e.target.result.byteLength);\n                handleBinaryFile(e.target.result);\n            };\n\n            fileReader.readAsArrayBuffer(img);\n        }\n    }\n\n    function findEXIFinJPEG(file) {\n        var dataView = new DataView(file);\n\n        if (debug) console.log(\"Got file of length \" + file.byteLength);\n        if ((dataView.getUint8(0) != 0xFF) || (dataView.getUint8(1) != 0xD8)) {\n            if (debug) console.log(\"Not a valid JPEG\");\n            return false; // not a valid jpeg\n        }\n\n        var offset = 2,\n            length = file.byteLength,\n            marker;\n\n        while (offset < length) {\n            if (dataView.getUint8(offset) != 0xFF) {\n                if (debug) console.log(\"Not a valid marker at offset \" + offset + \", found: \" + dataView.getUint8(offset));\n                return false; // not a valid marker, something is wrong\n            }\n\n            marker = dataView.getUint8(offset + 1);\n            if (debug) console.log(marker);\n\n            // we could implement handling for other markers here,\n            // but we're only looking for 0xFFE1 for EXIF data\n\n            if (marker == 225) {\n                if (debug) console.log(\"Found 0xFFE1 marker\");\n\n                return readEXIFData(dataView, offset + 4, dataView.getUint16(offset + 2) - 2);\n\n                // offset += 2 + file.getShortAt(offset+2, true);\n\n            } else {\n                offset += 2 + dataView.getUint16(offset+2);\n            }\n\n        }\n\n    }\n\n    function findIPTCinJPEG(file) {\n        var dataView = new DataView(file);\n\n        if (debug) console.log(\"Got file of length \" + file.byteLength);\n        if ((dataView.getUint8(0) != 0xFF) || (dataView.getUint8(1) != 0xD8)) {\n            if (debug) console.log(\"Not a valid JPEG\");\n            return false; // not a valid jpeg\n        }\n\n        var offset = 2,\n            length = file.byteLength;\n\n\n        var isFieldSegmentStart = function(dataView, offset){\n            return (\n                dataView.getUint8(offset) === 0x38 &&\n                dataView.getUint8(offset+1) === 0x42 &&\n                dataView.getUint8(offset+2) === 0x49 &&\n                dataView.getUint8(offset+3) === 0x4D &&\n                dataView.getUint8(offset+4) === 0x04 &&\n                dataView.getUint8(offset+5) === 0x04\n            );\n        };\n\n        while (offset < length) {\n\n            if ( isFieldSegmentStart(dataView, offset )){\n\n                // Get the length of the name header (which is padded to an even number of bytes)\n                var nameHeaderLength = dataView.getUint8(offset+7);\n                if(nameHeaderLength % 2 !== 0) nameHeaderLength += 1;\n                // Check for pre photoshop 6 format\n                if(nameHeaderLength === 0) {\n                    // Always 4\n                    nameHeaderLength = 4;\n                }\n\n                var startOffset = offset + 8 + nameHeaderLength;\n                var sectionLength = dataView.getUint16(offset + 6 + nameHeaderLength);\n\n                return readIPTCData(file, startOffset, sectionLength);\n\n                break;\n\n            }\n\n\n            // Not the marker, continue searching\n            offset++;\n\n        }\n\n    }\n    var IptcFieldMap = {\n        0x78 : 'caption',\n        0x6E : 'credit',\n        0x19 : 'keywords',\n        0x37 : 'dateCreated',\n        0x50 : 'byline',\n        0x55 : 'bylineTitle',\n        0x7A : 'captionWriter',\n        0x69 : 'headline',\n        0x74 : 'copyright',\n        0x0F : 'category'\n    };\n    function readIPTCData(file, startOffset, sectionLength){\n        var dataView = new DataView(file);\n        var data = {};\n        var fieldValue, fieldName, dataSize, segmentType, segmentSize;\n        var segmentStartPos = startOffset;\n        while(segmentStartPos < startOffset+sectionLength) {\n            if(dataView.getUint8(segmentStartPos) === 0x1C && dataView.getUint8(segmentStartPos+1) === 0x02){\n                segmentType = dataView.getUint8(segmentStartPos+2);\n                if(segmentType in IptcFieldMap) {\n                    dataSize = dataView.getInt16(segmentStartPos+3);\n                    segmentSize = dataSize + 5;\n                    fieldName = IptcFieldMap[segmentType];\n                    fieldValue = getStringFromDB(dataView, segmentStartPos+5, dataSize);\n                    // Check if we already stored a value with this name\n                    if(data.hasOwnProperty(fieldName)) {\n                        // Value already stored with this name, create multivalue field\n                        if(data[fieldName] instanceof Array) {\n                            data[fieldName].push(fieldValue);\n                        }\n                        else {\n                            data[fieldName] = [data[fieldName], fieldValue];\n                        }\n                    }\n                    else {\n                        data[fieldName] = fieldValue;\n                    }\n                }\n\n            }\n            segmentStartPos++;\n        }\n        return data;\n    }\n\n\n\n    function readTags(file, tiffStart, dirStart, strings, bigEnd) {\n        var entries = file.getUint16(dirStart, !bigEnd),\n            tags = {},\n            entryOffset, tag,\n            i;\n\n        for (i=0;i<entries;i++) {\n            entryOffset = dirStart + i*12 + 2;\n            tag = strings[file.getUint16(entryOffset, !bigEnd)];\n            if (!tag && debug) console.log(\"Unknown tag: \" + file.getUint16(entryOffset, !bigEnd));\n            tags[tag] = readTagValue(file, entryOffset, tiffStart, dirStart, bigEnd);\n        }\n        return tags;\n    }\n\n\n    function readTagValue(file, entryOffset, tiffStart, dirStart, bigEnd) {\n        var type = file.getUint16(entryOffset+2, !bigEnd),\n            numValues = file.getUint32(entryOffset+4, !bigEnd),\n            valueOffset = file.getUint32(entryOffset+8, !bigEnd) + tiffStart,\n            offset,\n            vals, val, n,\n            numerator, denominator;\n\n        switch (type) {\n            case 1: // byte, 8-bit unsigned int\n            case 7: // undefined, 8-bit byte, value depending on field\n                if (numValues == 1) {\n                    return file.getUint8(entryOffset + 8, !bigEnd);\n                } else {\n                    offset = numValues > 4 ? valueOffset : (entryOffset + 8);\n                    vals = [];\n                    for (n=0;n<numValues;n++) {\n                        vals[n] = file.getUint8(offset + n);\n                    }\n                    return vals;\n                }\n\n            case 2: // ascii, 8-bit byte\n                offset = numValues > 4 ? valueOffset : (entryOffset + 8);\n                return getStringFromDB(file, offset, numValues-1);\n\n            case 3: // short, 16 bit int\n                if (numValues == 1) {\n                    return file.getUint16(entryOffset + 8, !bigEnd);\n                } else {\n                    offset = numValues > 2 ? valueOffset : (entryOffset + 8);\n                    vals = [];\n                    for (n=0;n<numValues;n++) {\n                        vals[n] = file.getUint16(offset + 2*n, !bigEnd);\n                    }\n                    return vals;\n                }\n\n            case 4: // long, 32 bit int\n                if (numValues == 1) {\n                    return file.getUint32(entryOffset + 8, !bigEnd);\n                } else {\n                    vals = [];\n                    for (n=0;n<numValues;n++) {\n                        vals[n] = file.getUint32(valueOffset + 4*n, !bigEnd);\n                    }\n                    return vals;\n                }\n\n            case 5:    // rational = two long values, first is numerator, second is denominator\n                if (numValues == 1) {\n                    numerator = file.getUint32(valueOffset, !bigEnd);\n                    denominator = file.getUint32(valueOffset+4, !bigEnd);\n                    val = new Number(numerator / denominator);\n                    val.numerator = numerator;\n                    val.denominator = denominator;\n                    return val;\n                } else {\n                    vals = [];\n                    for (n=0;n<numValues;n++) {\n                        numerator = file.getUint32(valueOffset + 8*n, !bigEnd);\n                        denominator = file.getUint32(valueOffset+4 + 8*n, !bigEnd);\n                        vals[n] = new Number(numerator / denominator);\n                        vals[n].numerator = numerator;\n                        vals[n].denominator = denominator;\n                    }\n                    return vals;\n                }\n\n            case 9: // slong, 32 bit signed int\n                if (numValues == 1) {\n                    return file.getInt32(entryOffset + 8, !bigEnd);\n                } else {\n                    vals = [];\n                    for (n=0;n<numValues;n++) {\n                        vals[n] = file.getInt32(valueOffset + 4*n, !bigEnd);\n                    }\n                    return vals;\n                }\n\n            case 10: // signed rational, two slongs, first is numerator, second is denominator\n                if (numValues == 1) {\n                    return file.getInt32(valueOffset, !bigEnd) / file.getInt32(valueOffset+4, !bigEnd);\n                } else {\n                    vals = [];\n                    for (n=0;n<numValues;n++) {\n                        vals[n] = file.getInt32(valueOffset + 8*n, !bigEnd) / file.getInt32(valueOffset+4 + 8*n, !bigEnd);\n                    }\n                    return vals;\n                }\n        }\n    }\n\n    /**\n    * Given an IFD (Image File Directory) start offset\n    * returns an offset to next IFD or 0 if it's the last IFD.\n    */\n    function getNextIFDOffset(dataView, dirStart, bigEnd){\n        //the first 2bytes means the number of directory entries contains in this IFD\n        var entries = dataView.getUint16(dirStart, !bigEnd);\n\n        // After last directory entry, there is a 4bytes of data,\n        // it means an offset to next IFD.\n        // If its value is '0x00000000', it means this is the last IFD and there is no linked IFD.\n\n        return dataView.getUint32(dirStart + 2 + entries * 12, !bigEnd); // each entry is 12 bytes long\n    }\n\n    function readThumbnailImage(dataView, tiffStart, firstIFDOffset, bigEnd){\n        // get the IFD1 offset\n        var IFD1OffsetPointer = getNextIFDOffset(dataView, tiffStart+firstIFDOffset, bigEnd);\n\n        if (!IFD1OffsetPointer) {\n            // console.log('******** IFD1Offset is empty, image thumb not found ********');\n            return {};\n        }\n        else if (IFD1OffsetPointer > dataView.byteLength) { // this should not happen\n            // console.log('******** IFD1Offset is outside the bounds of the DataView ********');\n            return {};\n        }\n        // console.log('*******  thumbnail IFD offset (IFD1) is: %s', IFD1OffsetPointer);\n\n        var thumbTags = readTags(dataView, tiffStart, tiffStart + IFD1OffsetPointer, IFD1Tags, bigEnd)\n\n        // EXIF 2.3 specification for JPEG format thumbnail\n\n        // If the value of Compression(0x0103) Tag in IFD1 is '6', thumbnail image format is JPEG.\n        // Most of Exif image uses JPEG format for thumbnail. In that case, you can get offset of thumbnail\n        // by JpegIFOffset(0x0201) Tag in IFD1, size of thumbnail by JpegIFByteCount(0x0202) Tag.\n        // Data format is ordinary JPEG format, starts from 0xFFD8 and ends by 0xFFD9. It seems that\n        // JPEG format and 160x120pixels of size are recommended thumbnail format for Exif2.1 or later.\n\n        if (thumbTags['Compression']) {\n            // console.log('Thumbnail image found!');\n\n            switch (thumbTags['Compression']) {\n                case 6:\n                    // console.log('Thumbnail image format is JPEG');\n                    if (thumbTags.JpegIFOffset && thumbTags.JpegIFByteCount) {\n                    // extract the thumbnail\n                        var tOffset = tiffStart + thumbTags.JpegIFOffset;\n                        var tLength = thumbTags.JpegIFByteCount;\n                        thumbTags['blob'] = new Blob([new Uint8Array(dataView.buffer, tOffset, tLength)], {\n                            type: 'image/jpeg'\n                        });\n                    }\n                break;\n\n            case 1:\n                console.log(\"Thumbnail image format is TIFF, which is not implemented.\");\n                break;\n            default:\n                console.log(\"Unknown thumbnail image format '%s'\", thumbTags['Compression']);\n            }\n        }\n        else if (thumbTags['PhotometricInterpretation'] == 2) {\n            console.log(\"Thumbnail image format is RGB, which is not implemented.\");\n        }\n        return thumbTags;\n    }\n\n    function getStringFromDB(buffer, start, length) {\n        var outstr = \"\";\n        for (n = start; n < start+length; n++) {\n            outstr += String.fromCharCode(buffer.getUint8(n));\n        }\n        return outstr;\n    }\n\n    function readEXIFData(file, start) {\n        if (getStringFromDB(file, start, 4) != \"Exif\") {\n            if (debug) console.log(\"Not valid EXIF data! \" + getStringFromDB(file, start, 4));\n            return false;\n        }\n\n        var bigEnd,\n            tags, tag,\n            exifData, gpsData,\n            tiffOffset = start + 6;\n\n        // test for TIFF validity and endianness\n        if (file.getUint16(tiffOffset) == 0x4949) {\n            bigEnd = false;\n        } else if (file.getUint16(tiffOffset) == 0x4D4D) {\n            bigEnd = true;\n        } else {\n            if (debug) console.log(\"Not valid TIFF data! (no 0x4949 or 0x4D4D)\");\n            return false;\n        }\n\n        if (file.getUint16(tiffOffset+2, !bigEnd) != 0x002A) {\n            if (debug) console.log(\"Not valid TIFF data! (no 0x002A)\");\n            return false;\n        }\n\n        var firstIFDOffset = file.getUint32(tiffOffset+4, !bigEnd);\n\n        if (firstIFDOffset < 0x00000008) {\n            if (debug) console.log(\"Not valid TIFF data! (First offset less than 8)\", file.getUint32(tiffOffset+4, !bigEnd));\n            return false;\n        }\n\n        tags = readTags(file, tiffOffset, tiffOffset + firstIFDOffset, TiffTags, bigEnd);\n\n        if (tags.ExifIFDPointer) {\n            exifData = readTags(file, tiffOffset, tiffOffset + tags.ExifIFDPointer, ExifTags, bigEnd);\n            for (tag in exifData) {\n                switch (tag) {\n                    case \"LightSource\" :\n                    case \"Flash\" :\n                    case \"MeteringMode\" :\n                    case \"ExposureProgram\" :\n                    case \"SensingMethod\" :\n                    case \"SceneCaptureType\" :\n                    case \"SceneType\" :\n                    case \"CustomRendered\" :\n                    case \"WhiteBalance\" :\n                    case \"GainControl\" :\n                    case \"Contrast\" :\n                    case \"Saturation\" :\n                    case \"Sharpness\" :\n                    case \"SubjectDistanceRange\" :\n                    case \"FileSource\" :\n                        exifData[tag] = StringValues[tag][exifData[tag]];\n                        break;\n\n                    case \"ExifVersion\" :\n                    case \"FlashpixVersion\" :\n                        exifData[tag] = String.fromCharCode(exifData[tag][0], exifData[tag][1], exifData[tag][2], exifData[tag][3]);\n                        break;\n\n                    case \"ComponentsConfiguration\" :\n                        exifData[tag] =\n                            StringValues.Components[exifData[tag][0]] +\n                            StringValues.Components[exifData[tag][1]] +\n                            StringValues.Components[exifData[tag][2]] +\n                            StringValues.Components[exifData[tag][3]];\n                        break;\n                }\n                tags[tag] = exifData[tag];\n            }\n        }\n\n        if (tags.GPSInfoIFDPointer) {\n            gpsData = readTags(file, tiffOffset, tiffOffset + tags.GPSInfoIFDPointer, GPSTags, bigEnd);\n            for (tag in gpsData) {\n                switch (tag) {\n                    case \"GPSVersionID\" :\n                        gpsData[tag] = gpsData[tag][0] +\n                            \".\" + gpsData[tag][1] +\n                            \".\" + gpsData[tag][2] +\n                            \".\" + gpsData[tag][3];\n                        break;\n                }\n                tags[tag] = gpsData[tag];\n            }\n        }\n\n        // extract thumbnail\n        tags['thumbnail'] = readThumbnailImage(file, tiffOffset, firstIFDOffset, bigEnd);\n\n        return tags;\n    }\n\n   function findXMPinJPEG(file) {\n\n        if (!('DOMParser' in self)) {\n            // console.warn('XML parsing not supported without DOMParser');\n            return;\n        }\n        var dataView = new DataView(file);\n\n        if (debug) console.log(\"Got file of length \" + file.byteLength);\n        if ((dataView.getUint8(0) != 0xFF) || (dataView.getUint8(1) != 0xD8)) {\n           if (debug) console.log(\"Not a valid JPEG\");\n           return false; // not a valid jpeg\n        }\n\n        var offset = 2,\n            length = file.byteLength,\n            dom = new DOMParser();\n\n        while (offset < (length-4)) {\n            if (getStringFromDB(dataView, offset, 4) == \"http\") {\n                var startOffset = offset - 1;\n                var sectionLength = dataView.getUint16(offset - 2) - 1;\n                var xmpString = getStringFromDB(dataView, startOffset, sectionLength)\n                var xmpEndIndex = xmpString.indexOf('xmpmeta>') + 8;\n                xmpString = xmpString.substring( xmpString.indexOf( '<x:xmpmeta' ), xmpEndIndex );\n\n                var indexOfXmp = xmpString.indexOf('x:xmpmeta') + 10\n                //Many custom written programs embed xmp/xml without any namespace. Following are some of them.\n                //Without these namespaces, XML is thought to be invalid by parsers\n                xmpString = xmpString.slice(0, indexOfXmp)\n                            + 'xmlns:Iptc4xmpCore=\"http://iptc.org/std/Iptc4xmpCore/1.0/xmlns/\" '\n                            + 'xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" '\n                            + 'xmlns:tiff=\"http://ns.adobe.com/tiff/1.0/\" '\n                            + 'xmlns:plus=\"http://schemas.android.com/apk/lib/com.google.android.gms.plus\" '\n                            + 'xmlns:ext=\"http://www.gettyimages.com/xsltExtension/1.0\" '\n                            + 'xmlns:exif=\"http://ns.adobe.com/exif/1.0/\" '\n                            + 'xmlns:stEvt=\"http://ns.adobe.com/xap/1.0/sType/ResourceEvent#\" '\n                            + 'xmlns:stRef=\"http://ns.adobe.com/xap/1.0/sType/ResourceRef#\" '\n                            + 'xmlns:crs=\"http://ns.adobe.com/camera-raw-settings/1.0/\" '\n                            + 'xmlns:xapGImg=\"http://ns.adobe.com/xap/1.0/g/img/\" '\n                            + 'xmlns:Iptc4xmpExt=\"http://iptc.org/std/Iptc4xmpExt/2008-02-29/\" '\n                            + xmpString.slice(indexOfXmp)\n\n                var domDocument = dom.parseFromString( xmpString, 'text/xml' );\n                return xml2Object(domDocument);\n            } else{\n             offset++;\n            }\n        }\n    }\n\n    function xml2json(xml) {\n        var json = {};\n      \n        if (xml.nodeType == 1) { // element node\n          if (xml.attributes.length > 0) {\n            json['@attributes'] = {};\n            for (var j = 0; j < xml.attributes.length; j++) {\n              var attribute = xml.attributes.item(j);\n              json['@attributes'][attribute.nodeName] = attribute.nodeValue;\n            }\n          }\n        } else if (xml.nodeType == 3) { // text node\n          return xml.nodeValue;\n        }\n      \n        // deal with children\n        if (xml.hasChildNodes()) {\n          for(var i = 0; i < xml.childNodes.length; i++) {\n            var child = xml.childNodes.item(i);\n            var nodeName = child.nodeName;\n            if (json[nodeName] == null) {\n              json[nodeName] = xml2json(child);\n            } else {\n              if (json[nodeName].push == null) {\n                var old = json[nodeName];\n                json[nodeName] = [];\n                json[nodeName].push(old);\n              }\n              json[nodeName].push(xml2json(child));\n            }\n          }\n        }\n        \n        return json;\n    }\n\n    function xml2Object(xml) {\n        try {\n            var obj = {};\n            if (xml.children.length > 0) {\n              for (var i = 0; i < xml.children.length; i++) {\n                var item = xml.children.item(i);\n                var attributes = item.attributes;\n                for(var idx in attributes) {\n                    var itemAtt = attributes[idx];\n                    var dataKey = itemAtt.nodeName;\n                    var dataValue = itemAtt.nodeValue;\n\n                    if(dataKey !== undefined) {\n                        obj[dataKey] = dataValue;\n                    }\n                }\n                var nodeName = item.nodeName;\n\n                if (typeof (obj[nodeName]) == \"undefined\") {\n                  obj[nodeName] = xml2json(item);\n                } else {\n                  if (typeof (obj[nodeName].push) == \"undefined\") {\n                    var old = obj[nodeName];\n\n                    obj[nodeName] = [];\n                    obj[nodeName].push(old);\n                  }\n                  obj[nodeName].push(xml2json(item));\n                }\n              }\n            } else {\n              obj = xml.textContent;\n            }\n            return obj;\n          } catch (e) {\n              console.log(e.message);\n          }\n    }\n\n    EXIF.enableXmp = function() {\n        EXIF.isXmpEnabled = true;\n    }\n\n    EXIF.disableXmp = function() {\n        EXIF.isXmpEnabled = false;\n    }\n\n    EXIF.getData = function(img, callback) {\n        if (((self.Image && img instanceof self.Image)\n            || (self.HTMLImageElement && img instanceof self.HTMLImageElement))\n            && !img.complete)\n            return false;\n\n        if (!imageHasData(img)) {\n            getImageData(img, callback);\n        } else {\n            if (callback) {\n                callback.call(img);\n            }\n        }\n        return true;\n    }\n\n    EXIF.getTag = function(img, tag) {\n        if (!imageHasData(img)) return;\n        return img.exifdata[tag];\n    }\n    \n    EXIF.getIptcTag = function(img, tag) {\n        if (!imageHasData(img)) return;\n        return img.iptcdata[tag];\n    }\n\n    EXIF.getAllTags = function(img) {\n        if (!imageHasData(img)) return {};\n        var a,\n            data = img.exifdata,\n            tags = {};\n        for (a in data) {\n            if (data.hasOwnProperty(a)) {\n                tags[a] = data[a];\n            }\n        }\n        return tags;\n    }\n    \n    EXIF.getAllIptcTags = function(img) {\n        if (!imageHasData(img)) return {};\n        var a,\n            data = img.iptcdata,\n            tags = {};\n        for (a in data) {\n            if (data.hasOwnProperty(a)) {\n                tags[a] = data[a];\n            }\n        }\n        return tags;\n    }\n\n    EXIF.pretty = function(img) {\n        if (!imageHasData(img)) return \"\";\n        var a,\n            data = img.exifdata,\n            strPretty = \"\";\n        for (a in data) {\n            if (data.hasOwnProperty(a)) {\n                if (typeof data[a] == \"object\") {\n                    if (data[a] instanceof Number) {\n                        strPretty += a + \" : \" + data[a] + \" [\" + data[a].numerator + \"/\" + data[a].denominator + \"]\\r\\n\";\n                    } else {\n                        strPretty += a + \" : [\" + data[a].length + \" values]\\r\\n\";\n                    }\n                } else {\n                    strPretty += a + \" : \" + data[a] + \"\\r\\n\";\n                }\n            }\n        }\n        return strPretty;\n    }\n\n    EXIF.readFromBinaryFile = function(file) {\n        return findEXIFinJPEG(file);\n    }\n\n    if (typeof define === 'function' && define.amd) {\n        define('exif-js', [], function() {\n            return EXIF;\n        });\n    }\n}.call(this));\n\n","import EXIF from 'exif-js';\r\n\r\n/**\r\n * 修正图片旋转角度问题\r\n * @param {File| string} file 原图片\r\n * @param {number} quality 输出质量\r\n * @return {Promise<File>} resolved promise 返回纠正后的新图片\r\n */\r\nexport function fixOrientation(file, quality = 0.92) {\r\n    return new Promise((resolve, reject) => {\r\n        // 获取图片\r\n        const img = new Image();\r\n        img.src = typeof file === 'string' ? file : window.URL.createObjectURL(file);\r\n        img.onerror = () => reject(file);\r\n        img.onload = () => {\r\n            // 获取图片元数据（EXIF 变量是引入的 exif-js 库暴露的全局变量）\r\n            EXIF.getData(img, function () {\r\n                // 获取图片旋转标志位\r\n                var orientation = EXIF.getTag(this, 'Orientation');\r\n                // 根据旋转角度，在画布上对图片进行旋转\r\n                if (orientation === 3 || orientation === 6 || orientation === 8) {\r\n                    const canvas = document.createElement('canvas');\r\n                    const ctx = canvas.getContext('2d');\r\n                    switch (orientation) {\r\n                    case 3: // 旋转180°\r\n                        canvas.width = img.width;\r\n                        canvas.height = img.height;\r\n                        ctx.rotate((180 * Math.PI) / 180);\r\n                        ctx.drawImage(img, -img.width, -img.height, img.width, img.height);\r\n                        break;\r\n                    case 6: // 旋转90°\r\n                        canvas.width = img.height;\r\n                        canvas.height = img.width;\r\n                        ctx.rotate((90 * Math.PI) / 180);\r\n                        ctx.drawImage(img, 0, -img.height, img.width, img.height);\r\n                        break;\r\n                    case 8: // 旋转-90°\r\n                        canvas.width = img.height;\r\n                        canvas.height = img.width;\r\n                        ctx.rotate((-90 * Math.PI) / 180);\r\n                        ctx.drawImage(img, -img.width, 0, img.width, img.height);\r\n                        break;\r\n                    }\r\n                    // 返回新图片\r\n                    canvas.toBlob(file => resolve(file), 'image/jpeg', quality);\r\n                } else {\r\n                    return resolve(file);\r\n                }\r\n            });\r\n        };\r\n    });\r\n}\r\n\r\n","function getOverlap(ax1, ay1, ax2, ay2, bx1, by1, bx2, by2) {\r\n    if (ax2 < bx1 || ay2 < by1 || ax1 > bx2 || ay1 > by2) return [0, 0, 0, 0];\r\n\r\n    var left = Math.max(ax1, bx1);\r\n    var top = Math.max(ay1, by1);\r\n    var right = Math.min(ax2, bx2);\r\n    var bottom = Math.min(ay2, by2);\r\n    return [left, top, right - left, bottom - top];\r\n}\r\n\r\n/**\r\n * 计算图片与裁剪框重叠区域\r\n * @param {HTMLImageElement} imgEl\r\n * @param {{height: number, width: number}} rect\r\n */\r\nexport function calculateRect(imgEl, rect) {\r\n    var cr = imgEl.getBoundingClientRect();\r\n    var c_left = window.innerWidth / 2 - rect.width / 2;\r\n    var c_top = window.innerHeight / 2 - rect.height / 2;\r\n    var cover_rect = [c_left, c_top, rect.width + c_left, rect.height + c_top];\r\n    var img_rect = [cr.left, cr.top, cr.width + cr.left, cr.height + cr.top];\r\n    var intersect_rect = getOverlap.apply(null, cover_rect.concat(img_rect));\r\n    var left = (intersect_rect[0] - img_rect[0]) / imgEl.scaleX;\r\n    var top = (intersect_rect[1] - img_rect[1]) / imgEl.scaleY;\r\n    var width = intersect_rect[2] / imgEl.scaleX;\r\n    var height = intersect_rect[3] / imgEl.scaleY;\r\n    if (left < 0)\r\n        left = 0;\r\n    if (top < 0)\r\n        top = 0;\r\n    if (left + width > imgEl.naturalWidth)\r\n        width = imgEl.naturalWidth - left;\r\n    if (top + height > imgEl.naturalHeight)\r\n        height = imgEl.naturalHeight - top;\r\n    return [left, top, width, height];\r\n}\r\n\r\n/**\r\n * 绘制裁剪区域\r\n * @param {HTMLImageElement} imgEl\r\n * @param {number[]} cropRect\r\n * @param {number} [output=1.5]\r\n */\r\nexport function drawCrop(ctx, imgEl, cropRect, output = 1.5) {\r\n    ctx.drawImage(imgEl, cropRect[0], cropRect[1], cropRect[2], cropRect[3], 0, 0, cropRect[2] * imgEl.scaleX * output, cropRect[3] * imgEl.scaleY * output);\r\n}\r\n\r\nexport function getCrop (imgEl, rect, output) {\r\n    return new Promise((resolve) => {\r\n        const canvas = document.createElement('canvas');\r\n        drawCrop(canvas.getContext('2d'), imgEl, calculateRect(imgEl, rect), output);\r\n        canvas.toBlob(file => resolve(file), 'image/jpeg', 0.92);\r\n    });\r\n}\r\n","/* transformjs\r\n * By dntzhang\r\n * http://alloyteam.github.io/AlloyTouch/transformjs/\r\n */\r\nvar Matrix3D = function (n11, n12, n13, n14, n21, n22, n23, n24, n31, n32, n33, n34, n41, n42, n43, n44) {\r\n    this.elements = window.Float32Array ? new Float32Array(16) : [];\r\n    var te = this.elements;\r\n    te[0] = (n11 !== undefined) ? n11 : 1; te[4] = n12 || 0; te[8] = n13 || 0; te[12] = n14 || 0;\r\n    te[1] = n21 || 0; te[5] = (n22 !== undefined) ? n22 : 1; te[9] = n23 || 0; te[13] = n24 || 0;\r\n    te[2] = n31 || 0; te[6] = n32 || 0; te[10] = (n33 !== undefined) ? n33 : 1; te[14] = n34 || 0;\r\n    te[3] = n41 || 0; te[7] = n42 || 0; te[11] = n43 || 0; te[15] = (n44 !== undefined) ? n44 : 1;\r\n};\r\n\r\nMatrix3D.DEG_TO_RAD = Math.PI / 180;\r\n\r\nMatrix3D.prototype = {\r\n    set: function (n11, n12, n13, n14, n21, n22, n23, n24, n31, n32, n33, n34, n41, n42, n43, n44) {\r\n        var te = this.elements;\r\n        te[0] = n11; te[4] = n12; te[8] = n13; te[12] = n14;\r\n        te[1] = n21; te[5] = n22; te[9] = n23; te[13] = n24;\r\n        te[2] = n31; te[6] = n32; te[10] = n33; te[14] = n34;\r\n        te[3] = n41; te[7] = n42; te[11] = n43; te[15] = n44;\r\n        return this;\r\n    },\r\n    identity: function () {\r\n        this.set(\r\n            1, 0, 0, 0,\r\n            0, 1, 0, 0,\r\n            0, 0, 1, 0,\r\n            0, 0, 0, 1\r\n        );\r\n        return this;\r\n    },\r\n    multiplyMatrices: function (a, be) {\r\n\r\n        var ae = a.elements;\r\n        var te = this.elements;\r\n        var a11 = ae[0], a12 = ae[4], a13 = ae[8], a14 = ae[12];\r\n        var a21 = ae[1], a22 = ae[5], a23 = ae[9], a24 = ae[13];\r\n        var a31 = ae[2], a32 = ae[6], a33 = ae[10], a34 = ae[14];\r\n        var a41 = ae[3], a42 = ae[7], a43 = ae[11], a44 = ae[15];\r\n\r\n        var b11 = be[0], b12 = be[1], b13 = be[2], b14 = be[3];\r\n        var b21 = be[4], b22 = be[5], b23 = be[6], b24 = be[7];\r\n        var b31 = be[8], b32 = be[9], b33 = be[10], b34 = be[11];\r\n        var b41 = be[12], b42 = be[13], b43 = be[14], b44 = be[15];\r\n\r\n        te[0] = a11 * b11 + a12 * b21 + a13 * b31 + a14 * b41;\r\n        te[4] = a11 * b12 + a12 * b22 + a13 * b32 + a14 * b42;\r\n        te[8] = a11 * b13 + a12 * b23 + a13 * b33 + a14 * b43;\r\n        te[12] = a11 * b14 + a12 * b24 + a13 * b34 + a14 * b44;\r\n\r\n        te[1] = a21 * b11 + a22 * b21 + a23 * b31 + a24 * b41;\r\n        te[5] = a21 * b12 + a22 * b22 + a23 * b32 + a24 * b42;\r\n        te[9] = a21 * b13 + a22 * b23 + a23 * b33 + a24 * b43;\r\n        te[13] = a21 * b14 + a22 * b24 + a23 * b34 + a24 * b44;\r\n\r\n        te[2] = a31 * b11 + a32 * b21 + a33 * b31 + a34 * b41;\r\n        te[6] = a31 * b12 + a32 * b22 + a33 * b32 + a34 * b42;\r\n        te[10] = a31 * b13 + a32 * b23 + a33 * b33 + a34 * b43;\r\n        te[14] = a31 * b14 + a32 * b24 + a33 * b34 + a34 * b44;\r\n\r\n        te[3] = a41 * b11 + a42 * b21 + a43 * b31 + a44 * b41;\r\n        te[7] = a41 * b12 + a42 * b22 + a43 * b32 + a44 * b42;\r\n        te[11] = a41 * b13 + a42 * b23 + a43 * b33 + a44 * b43;\r\n        te[15] = a41 * b14 + a42 * b24 + a43 * b34 + a44 * b44;\r\n\r\n        return this;\r\n\r\n    },\r\n    // 解决角度为90的整数倍导致Math.cos得到极小的数，其实是0。导致不渲染\r\n    _rounded: function (value, i) {\r\n        i = Math.pow(10, i || 15);\r\n        // default\r\n        return Math.round(value * i) / i;\r\n    },\r\n    appendTransform: function (x, y, z, scaleX, scaleY, scaleZ, rotateX, rotateY, rotateZ, skewX, skewY, originX, originY, originZ) {\r\n\r\n        var rx = rotateX * Matrix3D.DEG_TO_RAD;\r\n        var cosx = this._rounded(Math.cos(rx));\r\n        var sinx = this._rounded(Math.sin(rx));\r\n        var ry = rotateY * Matrix3D.DEG_TO_RAD;\r\n        var cosy = this._rounded(Math.cos(ry));\r\n        var siny = this._rounded(Math.sin(ry));\r\n        var rz = rotateZ * Matrix3D.DEG_TO_RAD;\r\n        var cosz = this._rounded(Math.cos(rz * -1));\r\n        var sinz = this._rounded(Math.sin(rz * -1));\r\n\r\n        this.multiplyMatrices(this, [\r\n            1, 0, 0, x,\r\n            0, cosx, sinx, y,\r\n            0, -sinx, cosx, z,\r\n            0, 0, 0, 1\r\n        ]);\r\n\r\n        this.multiplyMatrices(this, [\r\n            cosy, 0, siny, 0,\r\n            0, 1, 0, 0,\r\n            -siny, 0, cosy, 0,\r\n            0, 0, 0, 1\r\n        ]);\r\n\r\n        this.multiplyMatrices(this, [\r\n            cosz * scaleX, sinz * scaleY, 0, 0,\r\n            -sinz * scaleX, cosz * scaleY, 0, 0,\r\n            0, 0, 1 * scaleZ, 0,\r\n            0, 0, 0, 1\r\n        ]);\r\n\r\n        if (skewX || skewY) {\r\n            this.multiplyMatrices(this, [\r\n                this._rounded(Math.cos(skewX * Matrix3D.DEG_TO_RAD)), this._rounded(Math.sin(skewX * Matrix3D.DEG_TO_RAD)), 0, 0,\r\n                -1 * this._rounded(Math.sin(skewY * Matrix3D.DEG_TO_RAD)), this._rounded(Math.cos(skewY * Matrix3D.DEG_TO_RAD)), 0, 0,\r\n                0, 0, 1, 0,\r\n                0, 0, 0, 1\r\n            ]);\r\n        }\r\n\r\n        if (originX || originY || originZ) {\r\n            this.elements[12] -= originX * this.elements[0] + originY * this.elements[4] + originZ * this.elements[8];\r\n            this.elements[13] -= originX * this.elements[1] + originY * this.elements[5] + originZ * this.elements[9];\r\n            this.elements[14] -= originX * this.elements[2] + originY * this.elements[6] + originZ * this.elements[10];\r\n        }\r\n        return this;\r\n    }\r\n};\r\n\r\nfunction observe(target, props, callback) {\r\n    for (var i = 0, len = props.length; i < len; i++) {\r\n        var prop = props[i];\r\n        watch(target, prop, callback);\r\n    }\r\n}\r\n\r\nfunction watch(target, prop, callback) {\r\n    Object.defineProperty(target, prop, {\r\n        get: function () {\r\n            return this['__' + prop];\r\n        },\r\n        set: function (value) {\r\n            if (value !== this['__' + prop]) {\r\n                this['__' + prop] = value;\r\n                callback();\r\n            }\r\n\r\n        }\r\n    });\r\n}\r\n\r\nvar Transform = function (element) {\r\n\r\n    observe(\r\n        element,\r\n        ['translateX', 'translateY', 'translateZ', 'scaleX', 'scaleY', 'scaleZ', 'rotateX', 'rotateY', 'rotateZ', 'skewX', 'skewY', 'originX', 'originY', 'originZ'],\r\n        function () {\r\n            var mtx = element.matrix3D.identity().appendTransform(element.translateX, element.translateY, element.translateZ, element.scaleX, element.scaleY, element.scaleZ, element.rotateX, element.rotateY, element.rotateZ, element.skewX, element.skewY, element.originX, element.originY, element.originZ);\r\n            element.style.transform = element.style.msTransform = element.style.OTransform = element.style.MozTransform = element.style.webkitTransform = 'perspective(' + element.perspective + 'px) matrix3d(' + Array.prototype.slice.call(mtx.elements).join(',') + ')';\r\n        });\r\n\r\n    observe(\r\n        element,\r\n        ['perspective'],\r\n        function () {\r\n            element.style.transform = element.style.msTransform = element.style.OTransform = element.style.MozTransform = element.style.webkitTransform = 'perspective(' + element.perspective + 'px) matrix3d(' + Array.prototype.slice.call(element.matrix3D.elements).join(',') + ')';\r\n        });\r\n\r\n    element.matrix3D = new Matrix3D();\r\n    element.perspective = 500;\r\n    element.scaleX = element.scaleY = element.scaleZ = 1;\r\n    //由于image自带了x\\y\\z，所有加上translate前缀\r\n    element.translateX = element.translateY = element.translateZ = element.rotateX = element.rotateY = element.rotateZ = element.skewX = element.skewY = element.originX = element.originY = element.originZ = 0;\r\n};\r\n\r\nexport default Transform;\r\n","/* AlloyFinger v0.1.15\r\n * By dntzhang\r\n * Github: https://github.com/AlloyTeam/AlloyFinger\r\n */\r\n; (function () {\r\n    function getLen(v) {\r\n        return Math.sqrt(v.x * v.x + v.y * v.y);\r\n    }\r\n\r\n    function dot(v1, v2) {\r\n        return v1.x * v2.x + v1.y * v2.y;\r\n    }\r\n\r\n    function getAngle(v1, v2) {\r\n        var mr = getLen(v1) * getLen(v2);\r\n        if (mr === 0) return 0;\r\n        var r = dot(v1, v2) / mr;\r\n        if (r > 1) r = 1;\r\n        return Math.acos(r);\r\n    }\r\n\r\n    function cross(v1, v2) {\r\n        return v1.x * v2.y - v2.x * v1.y;\r\n    }\r\n\r\n    function getRotateAngle(v1, v2) {\r\n        var angle = getAngle(v1, v2);\r\n        if (cross(v1, v2) > 0) {\r\n            angle *= -1;\r\n        }\r\n\r\n        return angle * 180 / Math.PI;\r\n    }\r\n\r\n    var HandlerAdmin = function(el) {\r\n        this.handlers = [];\r\n        this.el = el;\r\n    };\r\n\r\n    HandlerAdmin.prototype.add = function(handler) {\r\n        this.handlers.push(handler);\r\n    }\r\n\r\n    HandlerAdmin.prototype.del = function(handler) {\r\n        if(!handler) this.handlers = [];\r\n\r\n        for(var i=this.handlers.length; i>=0; i--) {\r\n            if(this.handlers[i] === handler) {\r\n                this.handlers.splice(i, 1);\r\n            }\r\n        }\r\n    }\r\n\r\n    HandlerAdmin.prototype.dispatch = function() {\r\n        for(var i=0,len=this.handlers.length; i<len; i++) {\r\n            var handler = this.handlers[i];\r\n            if(typeof handler === 'function') handler.apply(this.el, arguments);\r\n        }\r\n    }\r\n\r\n    function wrapFunc(el, handler) {\r\n        var handlerAdmin = new HandlerAdmin(el);\r\n        handlerAdmin.add(handler);\r\n\r\n        return handlerAdmin;\r\n    }\r\n\r\n    var AlloyFinger = function (el, option) {\r\n\r\n        this.element = typeof el == 'string' ? document.querySelector(el) : el;\r\n\r\n        this.start = this.start.bind(this);\r\n        this.move = this.move.bind(this);\r\n        this.end = this.end.bind(this);\r\n        this.cancel = this.cancel.bind(this);\r\n        this.element.addEventListener(\"touchstart\", this.start, false);\r\n        this.element.addEventListener(\"touchmove\", this.move, false);\r\n        this.element.addEventListener(\"touchend\", this.end, false);\r\n        this.element.addEventListener(\"touchcancel\", this.cancel, false);\r\n\r\n        this.preV = { x: null, y: null };\r\n        this.pinchStartLen = null;\r\n        this.zoom = 1;\r\n        this.isDoubleTap = false;\r\n\r\n        var noop = function () { };\r\n\r\n        this.rotate = wrapFunc(this.element, option.rotate || noop);\r\n        this.touchStart = wrapFunc(this.element, option.touchStart || noop);\r\n        this.multipointStart = wrapFunc(this.element, option.multipointStart || noop);\r\n        this.multipointEnd = wrapFunc(this.element, option.multipointEnd || noop);\r\n        this.pinch = wrapFunc(this.element, option.pinch || noop);\r\n        this.swipe = wrapFunc(this.element, option.swipe || noop);\r\n        this.tap = wrapFunc(this.element, option.tap || noop);\r\n        this.doubleTap = wrapFunc(this.element, option.doubleTap || noop);\r\n        this.longTap = wrapFunc(this.element, option.longTap || noop);\r\n        this.singleTap = wrapFunc(this.element, option.singleTap || noop);\r\n        this.pressMove = wrapFunc(this.element, option.pressMove || noop);\r\n        this.twoFingerPressMove = wrapFunc(this.element, option.twoFingerPressMove || noop);\r\n        this.touchMove = wrapFunc(this.element, option.touchMove || noop);\r\n        this.touchEnd = wrapFunc(this.element, option.touchEnd || noop);\r\n        this.touchCancel = wrapFunc(this.element, option.touchCancel || noop);\r\n\r\n        this._cancelAllHandler = this.cancelAll.bind(this);\r\n\r\n        window.addEventListener('scroll', this._cancelAllHandler);\r\n\r\n        this.delta = null;\r\n        this.last = null;\r\n        this.now = null;\r\n        this.tapTimeout = null;\r\n        this.singleTapTimeout = null;\r\n        this.longTapTimeout = null;\r\n        this.swipeTimeout = null;\r\n        this.x1 = this.x2 = this.y1 = this.y2 = null;\r\n        this.preTapPosition = { x: null, y: null };\r\n    };\r\n\r\n    AlloyFinger.prototype = {\r\n        start: function (evt) {\r\n            if (!evt.touches) return;\r\n            this.now = Date.now();\r\n            this.x1 = evt.touches[0].pageX;\r\n            this.y1 = evt.touches[0].pageY;\r\n            this.delta = this.now - (this.last || this.now);\r\n            this.touchStart.dispatch(evt, this.element);\r\n            if (this.preTapPosition.x !== null) {\r\n                this.isDoubleTap = (this.delta > 0 && this.delta <= 250 && Math.abs(this.preTapPosition.x - this.x1) < 30 && Math.abs(this.preTapPosition.y - this.y1) < 30);\r\n                if (this.isDoubleTap) clearTimeout(this.singleTapTimeout);\r\n            }\r\n            this.preTapPosition.x = this.x1;\r\n            this.preTapPosition.y = this.y1;\r\n            this.last = this.now;\r\n            var preV = this.preV,\r\n                len = evt.touches.length;\r\n            if (len > 1) {\r\n                this._cancelLongTap();\r\n                this._cancelSingleTap();\r\n                var v = { x: evt.touches[1].pageX - this.x1, y: evt.touches[1].pageY - this.y1 };\r\n                preV.x = v.x;\r\n                preV.y = v.y;\r\n                this.pinchStartLen = getLen(preV);\r\n                this.multipointStart.dispatch(evt, this.element);\r\n            }\r\n            this._preventTap = false;\r\n            this.longTapTimeout = setTimeout(function () {\r\n                this.longTap.dispatch(evt, this.element);\r\n                this._preventTap = true;\r\n            }.bind(this), 750);\r\n        },\r\n        move: function (evt) {\r\n            if (!evt.touches) return;\r\n            var preV = this.preV,\r\n                len = evt.touches.length,\r\n                currentX = evt.touches[0].pageX,\r\n                currentY = evt.touches[0].pageY;\r\n            this.isDoubleTap = false;\r\n            if (len > 1) {\r\n                var sCurrentX = evt.touches[1].pageX,\r\n                    sCurrentY = evt.touches[1].pageY\r\n                var v = { x: evt.touches[1].pageX - currentX, y: evt.touches[1].pageY - currentY };\r\n\r\n                if (preV.x !== null) {\r\n                    if (this.pinchStartLen > 0) {\r\n                        evt.zoom = getLen(v) / this.pinchStartLen;\r\n                        this.pinch.dispatch(evt, this.element);\r\n                    }\r\n\r\n                    evt.angle = getRotateAngle(v, preV);\r\n                    this.rotate.dispatch(evt, this.element);\r\n                }\r\n                preV.x = v.x;\r\n                preV.y = v.y;\r\n\r\n                if (this.x2 !== null && this.sx2 !== null) {\r\n                    evt.deltaX = (currentX - this.x2 + sCurrentX - this.sx2) / 2;\r\n                    evt.deltaY = (currentY - this.y2 + sCurrentY - this.sy2) / 2;\r\n                } else {\r\n                    evt.deltaX = 0;\r\n                    evt.deltaY = 0;\r\n                }\r\n                this.twoFingerPressMove.dispatch(evt, this.element);\r\n\r\n                this.sx2 = sCurrentX;\r\n                this.sy2 = sCurrentY;\r\n            } else {\r\n                if (this.x2 !== null) {\r\n                    evt.deltaX = currentX - this.x2;\r\n                    evt.deltaY = currentY - this.y2;\r\n\r\n                    //move事件中添加对当前触摸点到初始触摸点的判断，\r\n                    //如果曾经大于过某个距离(比如10),就认为是移动到某个地方又移回来，应该不再触发tap事件才对。\r\n                    var movedX = Math.abs(this.x1 - this.x2),\r\n                        movedY = Math.abs(this.y1 - this.y2);\r\n\r\n                    if(movedX > 10 || movedY > 10){\r\n                        this._preventTap = true;\r\n                    }\r\n\r\n                } else {\r\n                    evt.deltaX = 0;\r\n                    evt.deltaY = 0;\r\n                }\r\n                \r\n                \r\n                this.pressMove.dispatch(evt, this.element);\r\n            }\r\n\r\n            this.touchMove.dispatch(evt, this.element);\r\n\r\n            this._cancelLongTap();\r\n            this.x2 = currentX;\r\n            this.y2 = currentY;\r\n            \r\n            if (len > 1) {\r\n                evt.preventDefault();\r\n            }\r\n        },\r\n        end: function (evt) {\r\n            if (!evt.changedTouches) return;\r\n            this._cancelLongTap();\r\n            var self = this;\r\n            if (evt.touches.length < 2) {\r\n                this.multipointEnd.dispatch(evt, this.element);\r\n                this.sx2 = this.sy2 = null;\r\n            }\r\n\r\n            //swipe\r\n            if ((this.x2 && Math.abs(this.x1 - this.x2) > 30) ||\r\n                (this.y2 && Math.abs(this.y1 - this.y2) > 30)) {\r\n                evt.direction = this._swipeDirection(this.x1, this.x2, this.y1, this.y2);\r\n                this.swipeTimeout = setTimeout(function () {\r\n                    self.swipe.dispatch(evt, self.element);\r\n\r\n                }, 0)\r\n            } else {\r\n                this.tapTimeout = setTimeout(function () {\r\n                    if(!self._preventTap){\r\n                        self.tap.dispatch(evt, self.element);\r\n                    }\r\n                    // trigger double tap immediately\r\n                    if (self.isDoubleTap) {\r\n                        self.doubleTap.dispatch(evt, self.element);\r\n                        self.isDoubleTap = false;\r\n                    }\r\n                }, 0)\r\n\r\n                if (!self.isDoubleTap) {\r\n                    self.singleTapTimeout = setTimeout(function () {\r\n                        self.singleTap.dispatch(evt, self.element);\r\n                    }, 250);\r\n                }\r\n            }\r\n\r\n            this.touchEnd.dispatch(evt, this.element);\r\n\r\n            this.preV.x = 0;\r\n            this.preV.y = 0;\r\n            this.zoom = 1;\r\n            this.pinchStartLen = null;\r\n            this.x1 = this.x2 = this.y1 = this.y2 = null;\r\n        },\r\n        cancelAll: function () {\r\n            this._preventTap = true\r\n            clearTimeout(this.singleTapTimeout);\r\n            clearTimeout(this.tapTimeout);\r\n            clearTimeout(this.longTapTimeout);\r\n            clearTimeout(this.swipeTimeout);\r\n        },\r\n        cancel: function (evt) {\r\n            this.cancelAll()\r\n            this.touchCancel.dispatch(evt, this.element);\r\n        },\r\n        _cancelLongTap: function () {\r\n            clearTimeout(this.longTapTimeout);\r\n        },\r\n        _cancelSingleTap: function () {\r\n            clearTimeout(this.singleTapTimeout);\r\n        },\r\n        _swipeDirection: function (x1, x2, y1, y2) {\r\n            return Math.abs(x1 - x2) >= Math.abs(y1 - y2) ? (x1 - x2 > 0 ? 'Left' : 'Right') : (y1 - y2 > 0 ? 'Up' : 'Down')\r\n        },\r\n\r\n        on: function(evt, handler) {\r\n            if(this[evt]) {\r\n                this[evt].add(handler);\r\n            }\r\n        },\r\n\r\n        off: function(evt, handler) {\r\n            if(this[evt]) {\r\n                this[evt].del(handler);\r\n            }\r\n        },\r\n\r\n        destroy: function() {\r\n            if(this.singleTapTimeout) clearTimeout(this.singleTapTimeout);\r\n            if(this.tapTimeout) clearTimeout(this.tapTimeout);\r\n            if(this.longTapTimeout) clearTimeout(this.longTapTimeout);\r\n            if(this.swipeTimeout) clearTimeout(this.swipeTimeout);\r\n\r\n            this.element.removeEventListener(\"touchstart\", this.start);\r\n            this.element.removeEventListener(\"touchmove\", this.move);\r\n            this.element.removeEventListener(\"touchend\", this.end);\r\n            this.element.removeEventListener(\"touchcancel\", this.cancel);\r\n\r\n            this.rotate.del();\r\n            this.touchStart.del();\r\n            this.multipointStart.del();\r\n            this.multipointEnd.del();\r\n            this.pinch.del();\r\n            this.swipe.del();\r\n            this.tap.del();\r\n            this.doubleTap.del();\r\n            this.longTap.del();\r\n            this.singleTap.del();\r\n            this.pressMove.del();\r\n            this.twoFingerPressMove.del()\r\n            this.touchMove.del();\r\n            this.touchEnd.del();\r\n            this.touchCancel.del();\r\n\r\n            this.preV = this.pinchStartLen = this.zoom = this.isDoubleTap = this.delta = this.last = this.now = this.tapTimeout = this.singleTapTimeout = this.longTapTimeout = this.swipeTimeout = this.x1 = this.x2 = this.y1 = this.y2 = this.preTapPosition = this.rotate = this.touchStart = this.multipointStart = this.multipointEnd = this.pinch = this.swipe = this.tap = this.doubleTap = this.longTap = this.singleTap = this.pressMove = this.touchMove = this.touchEnd = this.touchCancel = this.twoFingerPressMove = null;\r\n\r\n            window.removeEventListener('scroll', this._cancelAllHandler);\r\n            return null;\r\n        }\r\n    };\r\n\r\n    if (typeof module !== 'undefined' && typeof exports === 'object') {\r\n        module.exports = AlloyFinger;\r\n    } else {\r\n        window.AlloyFinger = AlloyFinger;\r\n    }\r\n})();\r\n","\r\nimport Transform from './_transform';\r\nimport Finger from 'alloyfinger';\r\n\r\n/**\r\n * 使图片可拖拽、缩放\r\n * @param {HTMLImageElement} imgEl\r\n * @param {{height: number, width: number}} rect 裁剪框尺寸，用于计算拖拽边界\r\n */\r\nexport function transformImage(imgEl, rect, cropBox) {\r\n    const naturalWidth = imgEl.naturalWidth;\r\n    // const naturalHeight = imgEl.naturalHeight;\r\n\r\n    Transform(imgEl, true);\r\n\r\n    const scaling_x = window.innerWidth / naturalWidth;\r\n    let initScale = scaling_x;\r\n    const originScale = scaling_x;\r\n    imgEl.scaleX = imgEl.scaleY = scaling_x;\r\n    let first = 1;\r\n\r\n    // touch事件必须绑定到容器元素上，img在布局上被canvas遮挡; Finger配置参考: https://github.com/AlloyTeam/AlloyCrop/blob/master/alloy-crop.js\r\n    new Finger(cropBox, {\r\n        multipointStart: (evt) => {\r\n            var centerX = (evt.touches[0].pageX + evt.touches[1].pageX) / 2;\r\n            var centerY = (evt.touches[0].pageY + evt.touches[1].pageY) / 2;\r\n            var cr = imgEl.getBoundingClientRect();\r\n            var img_centerX = cr.left + cr.width / 2;\r\n            var img_centerY = cr.top + cr.height / 2;\r\n            var offX = centerX - img_centerX;\r\n            var offY = centerY - img_centerY;\r\n            var preOriginX = imgEl.originX;\r\n            var preOriginY = imgEl.originY;\r\n            imgEl.originX = offX / imgEl.scaleX;\r\n            imgEl.originY = offY / imgEl.scaleY;\r\n            //reset translateX and translateY\r\n\r\n            imgEl.translateX += offX - preOriginX * imgEl.scaleX;\r\n            imgEl.translateY += offY - preOriginY * imgEl.scaleX;\r\n\r\n\r\n            if (first == 1) {\r\n                imgEl.scaleX = imgEl.scaleY = initScale * 1.1;\r\n                ++first;\r\n            }\r\n\r\n            initScale = imgEl.scaleX;\r\n        },\r\n        rotate: () => {\r\n            // console.log('TODO: rotate ');\r\n        },\r\n        pinch: (evt) => {\r\n            var cr = imgEl.getBoundingClientRect();\r\n            var boxOffY = (document.documentElement.clientHeight - rect.height) / 2;\r\n\r\n            var tempo = evt.zoom;\r\n            var dw = (cr.width * tempo - cr.width) / 2;\r\n            var dh = (cr.height - cr.height * tempo) / 2;\r\n            if ((initScale * tempo <= 1.6) && (initScale * tempo >= originScale) && (dw >= cr.left) && (-dw <= (cr.right - rect.width)) && (dh <= (boxOffY - cr.top)) && (dh <= (cr.bottom - boxOffY - rect.height))) {\r\n                imgEl.scaleX = imgEl.scaleY = initScale * tempo;\r\n            }\r\n        },\r\n        pressMove: (evt) => {\r\n            var cr = imgEl.getBoundingClientRect();\r\n            var boxOffY = (document.documentElement.clientHeight - rect.height) / 2;\r\n            if ((boxOffY - cr.top - evt.deltaY >= 0) && (cr.bottom + evt.deltaY - boxOffY >= rect.height)) {\r\n                imgEl.translateY += evt.deltaY;\r\n            }\r\n            var boxOffX = (document.documentElement.clientWidth - rect.width) / 2;\r\n            if ((cr.left + evt.deltaX <= boxOffX) && (cr.right + evt.deltaX - boxOffX >= rect.width)) {\r\n                imgEl.translateX += evt.deltaX;\r\n            }\r\n            evt.preventDefault();\r\n        }\r\n    });\r\n}\r\n\r\n\r\n/**\r\n * 遮罩和裁剪框采用一个canvas绘制\r\n * @param {HTMLCanvasElement} cover\r\n * @param {{height: number, width: number}} rect\r\n * @param {boolean} [rectangle=true]\r\n */\r\nexport function renderCover(cover, rect, rectangle = true) {\r\n    const ctx = cover.getContext('2d');\r\n    const w = cover.width;\r\n    const h = cover.height;\r\n    const cw = rect.width;\r\n    const ch = rect.height;\r\n    ctx.save();\r\n    ctx.fillStyle = 'black';\r\n    ctx.globalAlpha = 0.7;\r\n    ctx.fillRect(0, 0, w, h);\r\n    ctx.restore();\r\n    ctx.save();\r\n    ctx.globalCompositeOperation = 'destination-out';\r\n    ctx.beginPath();\r\n    rectangle\r\n        ? ctx.rect(w / 2 - cw / 2, h / 2 - ch / 2, cw, ch) // rect\r\n        : ctx.arc(w / 2, h / 2, cw / 2 - 4, 0, Math.PI * 2, false); // circle\r\n    ctx.fill();\r\n    ctx.restore();\r\n    ctx.save();\r\n    ctx.beginPath();\r\n    ctx.strokeStyle = 'white';\r\n    rectangle\r\n        ? ctx.rect(w / 2 - cw / 2, h / 2 - ch / 2, cw, ch) // rect\r\n        : ctx.arc(w / 2, h / 2, cw / 2 - 4, 0, Math.PI * 2, false); // circle\r\n    ctx.stroke();\r\n}\r\n","export * from './compress';\r\nexport * from './fixOrientation';\r\nexport * from './crop';\r\nexport * from './cropUI';\r\n","\r\nimport { loadPage } from './pages';\r\nimport { css } from './domHelpers';\r\nimport { transformImage, renderCover, calculateRect, drawCrop, fixOrientation, compress } from '../helpers';\r\n\r\n// helpers\r\n\r\n/**\r\n * 创建一个容器元素\r\n */\r\nfunction createBox() {\r\n    const cropBox = document.createElement('div');\r\n    cropBox.className = 'crop-box';\r\n\r\n    css(cropBox, {\r\n        color: 'white',\r\n        textAlign: 'center',\r\n        fontSize: '18px',\r\n        textDecoration: 'none',\r\n        visibility: 'visible'\r\n    });\r\n\r\n    return cropBox;\r\n}\r\n\r\nfunction styleImage(imgEl) {\r\n    const naturalWidth = imgEl.naturalWidth;\r\n    const naturalHeight = imgEl.naturalHeight;\r\n\r\n    css(imgEl, {\r\n        position: 'fixed',\r\n        zIndex: '99',\r\n        left: '50%',\r\n        top: window.innerHeight / 2 + 'px',\r\n        marginLeft: naturalWidth / -2 + 'px',\r\n        marginTop: naturalHeight / -2 + 'px'\r\n    });\r\n}\r\n\r\nfunction styleCover(cover) {\r\n    cover.width = window.innerWidth;\r\n    cover.height = window.innerHeight;\r\n    css(cover, {\r\n        position: 'fixed',\r\n        zIndex: '100',\r\n        left: '0px',\r\n        top: '0px'\r\n    });\r\n}\r\n\r\n\r\nconst rect = {\r\n    height: 200,\r\n    width: 200\r\n};\r\n\r\n// 首页\r\n\r\nconst onFileChange = (e) => {\r\n    const currentFiles = e.target.files;\r\n    if (currentFiles.length > 0) {\r\n        fixOrientation(currentFiles[0])\r\n            .then(compress)\r\n            .then(\r\n                file => loadPage(crop, { imageSrc: window.URL.createObjectURL(file) })\r\n            );\r\n    }\r\n};\r\n\r\nconst home = {\r\n    pageName: 'home',\r\n    container: document.body.querySelector('[data-page=home]'),\r\n    events() {\r\n        return {\r\n            // TODO: 处理选择同样图片的情况，同样图片不触发事件\r\n            '#imageSelector:change': onFileChange,\r\n            '#imageLoader:change': onFileChange,\r\n            // hack: 在微信中不能点label调起相机，直接使用input或触发click事件才行\r\n            '#imageLoaderButton:click': () => {\r\n                const imageLoader = document.getElementById('imageLoader');\r\n                imageLoader.click();\r\n            }\r\n        };\r\n    },\r\n    render() {\r\n    },\r\n    cached() {\r\n    }\r\n};\r\n\r\n// 裁剪\r\n\r\nconst crop = {\r\n    pageName: 'crop',\r\n    container: document.body.querySelector('[data-page=crop]'),\r\n    /**\r\n     * \r\n     * @param {HTMLElement} container \r\n     */\r\n    events(container) {\r\n        return {\r\n            '.button-cancel:click': () => {\r\n                loadPage(home);\r\n            },\r\n            '.button-ok:click': () => {\r\n                const imgEl = container.querySelector('.crop-image');\r\n                loadPage(result, { imgEl, cropRect: calculateRect(imgEl, rect) });\r\n            }\r\n        };\r\n    },\r\n    /**\r\n     * \r\n     * @param {HTMLElement} container \r\n     * @param {*} param1 \r\n     */\r\n    render(container, { imageSrc }) {\r\n        const cropBox = createBox();\r\n\r\n        // 加载图片\r\n        const imgEl = document.createElement('img');\r\n        imgEl.className = 'crop-image';\r\n        imgEl.src = imageSrc;\r\n        imgEl.onload = () => {\r\n            styleImage(imgEl);\r\n            transformImage(imgEl, rect, cropBox);\r\n        };\r\n        cropBox.appendChild(imgEl);\r\n\r\n        // 创建canvas遮罩\r\n        const cover = document.createElement('canvas');\r\n        styleCover(cover);\r\n        renderCover(cover, rect);\r\n        cropBox.appendChild(cover);\r\n\r\n        container.querySelector('.page-content').appendChild(cropBox);\r\n    },\r\n    /**\r\n     * \r\n     * @param {HTMLElement} container \r\n     */\r\n    cached(container) {\r\n        const prevBox = container.querySelector('.crop-box');\r\n        if (prevBox) {\r\n            container.querySelector('.page-content').removeChild(prevBox);\r\n        }\r\n    }\r\n};\r\n\r\n// result\r\n\r\nconst result = {\r\n    pageName: 'result',\r\n    container: document.body.querySelector('[data-page=result]'),\r\n    events() {\r\n        return {\r\n            '.button:click': () => {\r\n                location.reload();\r\n            }\r\n        };\r\n    },\r\n    /**\r\n     * \r\n     * @param {HTMLElement} container \r\n     * @param {{imgEl: HTMLElement, cropRect: number[]}} param1 \r\n     */\r\n    render(container, { imgEl, cropRect }) {\r\n        const resultCanvas = container.querySelector('#resultCanvas');\r\n        drawCrop(resultCanvas.getContext('2d'), imgEl, cropRect, 1.5);\r\n    }\r\n};\r\n\r\nloadPage(home);\r\n"]}